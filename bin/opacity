#!/bin/bash

cfg="$HOME/.config/alacritty/alacritty.yml"

usage() {
  cat << EOF >&2
Usage: $(basename "$0") [OPTIONS]

Manage alacritty's background opacity value.
By default the current value is displayed.

OPTIONS:

  -s  <value>   Set value
  -i            Increase by .01
  -d            Decrease by .01
EOF
}

opacity_set() {
  local o="${1:-1}"
  if [[ $o =~ . ]]; then
    o="0${o}"
  fi
  yq eval ".background_opacity = $o" -i "$cfg"
}

opacity_get()       { yq eval ".background_opacity" "$cfg" ; }
opacity_decrease()  { opacity_set "$(echo "$(opacity_get)-.01" | bc)" ; }
opacity_increase()  { opacity_set "$(echo "$(opacity_get)+.01" | bc)" ; }

while getopts 's:id' flag; do
  case "${flag}" in
    s) opacity_set "$OPTARG" ; exit 0 ;;
    i) opacity_increase ; exit 0 ;;
    d) opacity_decrease ; exit 0;;
    *) usage ; exit 1 ;; 
  esac
done

opacity_get
